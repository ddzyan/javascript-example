## 简介

参考文章：

- https://juejin.im/post/5c199c0ae51d452f6028a072
- https://blog.csdn.net/qq_31001889/article/details/80321892
- http://es6.ruanyifeng.com/#docs/generator-async

js 运行特点为单线程,如果没有异步编程,则线程将要卡死。js 异步编程实现方法有：

1. 回调函数
2. 事件监听(主要用于浏览器端的事件绑定)
3. 事件驱动
4. Promise 对象
5. async 和 await

主要原理都是解决：js 主线程先执行主要逻辑代码,遇到 I/O ,计时器等耗时事件,则将事件推到事件循环中。在事件循环中遍历到事件状态完成后要如何通知主线程继续执行。![image](http://www.runoob.com/wp-content/uploads/2015/09/event_loop.jpg)

### 回调函数

回调函数是 js 异步编程最基础的方法,开发者可以通过回调函数,在事件完成后执行指定的代码。

优点：

1. 实现方法简单
2. 容易理解原理

缺点：

1. 代码耦合度高,容易造成回调地狱
2. 流程混乱不易阅读和理解

### 事件驱动

采用事件驱动模式,方法的执行顺序不取决于代码的顺序,而取决于某一个事件是否发生。通过消息发送和监听,采用事件驱动继续完成异步代码。nodejs 的核心就是采用了 V8 引擎实现了事件驱动,异步非堵塞 IO 架构,才在总舵后端 js 技术中脱颖而出。

测试代码 eventEmitter.js 实现发布/订阅模式

优点：

- 代码耦合度低

缺点：

- 流程不容易理解
- 代码书写比较混乱

### Promise 对象

Promise 为 es6 中新的语法,它的原理是将每个异步任务封装后返回一个 Promise 对象,该对象内有 then 方法,允许在状态成功后执行指定回调函数。还有 catch 方法允许在状态失败后执行指定回调函数。

Promise 可以理解为一个状态机,内部管理异步事件的状态。通过 resolve(成功),reject(失败)回调函数,管理这事件的状态完成后执行的方法。

优点：

- 链式调用,解决回调地狱问题
- 代码耦合度较低

缺点

- 语法比较复杂
- 代码十分冗余,不管什么操作，一眼看去都是一堆 then，原来的语义变得很不清楚。

### async/await

async/await 的进化过程：

1. 协程
2. generator 函数
3. Thunk 函数
4. async/await

首先要了解什么是协程,generator 函数

#### 协程

协程：多个线程互相协作，完成异步任务。运行流程如下：

1. 第一步，协程 A 开始执行
2. 第二步，协程 A 执行到一半，进入暂停，执行权转移到协程 B。
3. 第三步，（一段时间后）协程 B 交还执行权。
4. 第四步，协程 A 恢复执行。

上述的 协程 A 就是异步任务

#### generator 函数

Generator 函数是协程在 ES6 的实现，最大特点就是可以交出函数的执行权（即暂停执行）。

Generator 函数是 协程 在 es6 种的实现方式, 最大特点就是可以交出函数的执行权（即暂停执行）。函数返回一个遍历器对象,每次执行该对象的 next() 方法,才会执行内部的一个异步任务。返回的对象包含 2 个值(value,done),value 代表异步执行结果,done 代表 generator 是否执行完毕.

Generator 函数可以暂停执行和恢复执行，这是它能封装异步任务的根本原因

Generator 函数两个特性，使它可以作为异步编程的完整解决方案：函数体内外的数据交换和错误处理机制。

根据 generator.js demo 的代码，generator 函数已经将异步执行流程表示的很简洁，但是缺点是流程管理却不是很方便(什么时候执行第一阶段，什么时候执行第二阶段，执行第二阶段如果要用到第一阶段结果，还需要将值传递过去)

#### Thunk 函数

Thunk 函数是自动执行 Generator 函数的一种方法。

##### 参数求值策略

```js
function f(a, b) {
  return b;
}

f(3 * x * x - 2 * x - 1, x);
```

- 传值调用：在调用函数之前，就已经对传入的参数进行求值，并且将结果传递进函数
- 传名调用: 只有在用到传入参数的时候，才对参数进行求值

#### async 和 await

async 函数就是 Generator 函数的语法糖,表示返回一个 Promise 对象
